---
layout:     post                  
title:      linux
subtitle:   linux è°ƒè¯•coreæ–‡ä»¶
date:       2019-04-10          
author:     Liangjf                  
header-img: img/post-bg-BJJ.jpg
catalog: true                      
tags:                       
    - linux
---

> â€œğŸ™‰ğŸ™‰ğŸ™‰ â€

**èƒŒæ™¯æ˜¯äººç±»é¦–å¼ é»‘æ´ç…§ç‰‡ï¼Œçºªå¿µä¸€ä¸‹ï¼Œç¡®å®å¾ˆéœ‡æ’¼ï¼ï¼ï¼**

# linux è°ƒè¯•coreæ–‡ä»¶
coreæ–‡ä»¶æ˜¯åº”ç”¨ç¨‹åºå´©æºƒé‚£ç¬é—´çš„ç°åœºï¼ŒåŒ…æ‹¬ä¸€äº›æ ˆä¿¡æ¯ï¼Œå¼‚å¸¸ä¿¡æ¯ç­‰ã€‚ä¸ºæˆ‘ä»¬äº†è§£å´©æºƒç°åœºå‘ç”Ÿäº†å•¥ï¼Œå¥½ä¿®å¤å®ƒã€‚

## æ‰“å¼€core dumpåŠŸèƒ½
- `ulimit -c`æŸ¥çœ‹ï¼Œè‹¥æ˜¯0ï¼Œè¡¨ç¤ºæœªå¼€å¯å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤ä¸´æ—¶å¼€å¯
`ulimit -c unlimited`

- æ°¸ä¹…å¼€å¯æ–¹å¼
`/etc/security/limits.conf`ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ–¹å¼ä¿®æ”¹
	
		liangjf@ubuntu:~/study/learn_gdb$ cat /etc/security/limits.conf 
		# /etc/security/limits.conf
		#
		#Each line describes a limit for a user in the form:
		#
		#<domain>        <type>  <item>  <value>
		*				soft	core	unlimited

## ä½¿coreæ–‡ä»¶åŠ ä¸Šè¿›ç¨‹pid
`echo 1 >> /proc/sys/kernel/core_uses_pid`

## ä¿®æ”¹coreæ–‡ä»¶çš„ç”Ÿæˆè·¯å¾„å’Œåå­—
`echo "/tmp/corefile-%e-%p-%t" > /proc/sys/kernel/core_patter`

%eï¼šå¯æ‰§è¡Œæ–‡ä»¶åå­—ã€‚%pï¼špidã€‚%tï¼šæ—¶é—´æˆ³

## ä¾‹å­

	#include <unistd.h>
	#include <sys/time.h>
	#include <sys/resource.h>
	#include <stdio.h>
	#define CORE_SIZE   1024 * 1024 * 500
	
	int SetCoreFile()
	{
	    struct rlimit rlmt;
	    rlmt.rlim_cur = (rlim_t)CORE_SIZE;
	    rlmt.rlim_max  = (rlim_t)CORE_SIZE;
	    if (setrlimit(RLIMIT_CORE, &rlmt) == -1)
	        return -1; 
	}
	
	int fun1()
	{
	    /*è®¿é—®éæ³•å†…å­˜ï¼Œäº§ç”Ÿcoreæ–‡ä»¶*/
	    int *ptr = NULL;
	    *ptr = 10; 
	    return 0;
	}
	
	void fun2()
	{
		fun1();
	}
	
	
	void fun3()
	{
	    fun2();
	    printf("fun3\n");
	}
	
	int main(int argc, char *argv[])
	{
	    SetCoreFile();
	
	    fun3();
	
	    return 0;
	}

![](https://github.com/liangjfblue/liangjfblue.github.io/blob/master/img/post_learn_core.jpg?raw=true)

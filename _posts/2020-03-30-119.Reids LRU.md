---
layout:     post                  
title:      redis LRU
subtitle:   LRU配置参数
date:       2020-03-30
author:     Liangjf
header-img: img/post_bg_20200330_8.pg
catalog: true                      
tags:                       
    - redis
---

# Reids LRU
Redis 自带LRU，能够在必要的时候进行内存淘汰机制，清理内存，腾出空间，提高内存的利用率。

## LRU配置参数

Redis配置中和LRU有关的有三个：

- maxmemory: 配置Redis存储数据时指定限制的内存大小，比如100m。当缓存消耗的内存超过这个数值时, 将触发数据淘汰。该数据配置为0时，表示缓存的数据量没有限制, 即LRU功能不生效。64位的系统默认值为0，32位的系统默认内存限制为3GB
- maxmemory_policy: 触发数据淘汰后的淘汰策略
- maxmemory_samples: 随机采样的精度，也就是随即取出key的数目。该数值配置越大, 越接近于真实的LRU算法，但是数值越大，相应消耗也变高，对性能有一定影响，样本值默认为5。


## 淘汰策略
淘汰策略即maxmemory_policy的赋值有以下几种：

- noeviction:如果缓存数据超过了maxmemory限定值，并且客户端正在执行的命令(大部分的写入指令，但DEL和几个指令例外)会导致内存分配，则向客户端返回错误响应
- allkeys-lru: 对所有的键都采取LRU淘汰
- volatile-lru: 仅对设置了过期时间的键采取LRU淘汰
- allkeys-random: 随机回收所有的键
- volatile-random: 随机回收设置过期时间的键
- volatile-ttl: 仅淘汰设置了过期时间的键---淘汰生存时间TTL(Time To Live)更小的键


一般的经验规则:

- allkeys-lru策略：当预期请求符合一个幂次分布(二八法则等)，比如一部分的子集元素比其它其它元素被访问的更多时，可以选择这个策略。
- allkeys-random：循环连续的访问所有的键时，或者预期请求分布平均（所有元素被访问的概率都差不多）
- volatile-ttl：要采取这个策略，缓存对象的TTL值最好有差异
